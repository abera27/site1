<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ç®¡ç†è€…ãƒšãƒ¼ã‚¸ï¼ˆåœ°å›³ + ä½æ‰€ + éƒµä¾¿ç•ªå·ï¼‰</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <style>
    body { font-family: sans-serif; padding: 15px; }
    #map { height: 350px; border: 2px solid #444; margin-top: 10px; }
  </style>
</head>
<body>
  <h2>ğŸ” ä½ç½®æƒ…å ± ç®¡ç†ç”»é¢</h2>
  <input type="password" id="pass" placeholder="ç®¡ç†ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">
  <button id="start">ç›£è¦–é–‹å§‹</button>

  <p id="info">ã¾ã ä½ç½®æƒ…å ±ãŒã‚ã‚Šã¾ã›ã‚“</p>
  <div id="map"></div>

  <script>
    let map;
    let marker;

    function initMap() {
      map = L.map('map').setView([35.6812, 139.7671], 15);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19
      }).addTo(map);
      marker = L.marker([35.6812, 139.7671]).addTo(map);
    }

    async function updateLocation() {
      const password = document.getElementById('pass').value;
      const res = await fetch('/admin/location', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ password })
      });
      const data = await res.json();

      if (data.error) return info.innerText = "âŒ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™";
      if (!data.address) return info.innerText = "ã¾ã ä½ç½®æƒ…å ±ãŒé€ã‚‰ã‚Œã¦ã„ã¾ã›ã‚“";

      info.innerHTML = `ğŸ  ä½æ‰€: ${data.address}<br>ğŸ“¨ éƒµä¾¿ç•ªå·: ${data.postalCode}<br>ğŸ•’ ${data.time}`;
      marker.setLatLng([data.latitude, data.longitude]);
      map.setView([data.latitude, data.longitude], 16);
    }

    document.getElementById('start').addEventListener('click', () => {
      initMap();
      updateLocation();
      setInterval(updateLocation, 3000);
    });
  </script>
</body>
</html>
